{% extends "course_base.html" %}

{% block maincontent %}
<a href="/courses/{{course.code}}?tag=initiator">Go Back</a>
{% if edit_module == -1 %}
<h2 id="heading">Adding New Module</h2>
{% else %}
<h2 id="heading">Adding New Lesson to Module {{edit_module+1}}: {{course.contents[edit_module].name}}</h2>
{% endif %}

<form action = "/editcourse/{{course.code}}" method="post" id="edit_form" enctype="multipart/form-data" onsubmit="submitfunc()">
<table>
	<tr id="module_row">
	{% if edit_module == -1 %}
	<td>
		<input type="text" name="module_name" placeholder="Name of module">
		<div class="error">{{empty_title}}</div>
	</td>
	{% endif %}
	</tr>
	<input type="hidden" id="edit_module" name="edit_module" value="{{edit_module|string}}">

	<tr>
	<td>
		<input type="text" name="subtitle" placeholder="Title of lesson">
		<div class="error">{{empty_subtitle}}</div>
	</td>
	</tr>

	<tr>
	<td>
	<input type="radio" id="upload" class = "accordion" name="upload" value="file">Upload Video
		<div class="panel">
 		<input type="file" name="file">
		</div>
	</td>
	</tr>

	<tr>
	<td>
		<input type="radio" class = "accordion" name="upload" value="link">Video link
		<div class="panel">
 		<input type="text" name="link" placeholder="link">
		</div>
	</td>
	</tr>
	<tr><td>
	<div class="error">{{file_error}}</div>
	</td></tr>
</table>

	<textarea name="description" placeholder="Instructor comments">{{description}}</textarea>
	<input type="submit" value="Add">
</form>
{% endblock %}

{% block script %}
<script>
var radios = document.getElementsByName("upload");
var i;
for (i = 0; i < radios.length; i++) {
    radios[i].onclick = function(){
	var panels = document.getElementsByClassName("panel");
        var j;
        for(j = 0; j<panels.length; j++){
        	panels[j].style.display = "none";
        }

        var panel = this.nextElementSibling;
        if(panel.className == "panel")
        	panel.style.display = "block";
        
        var form = document.getElementById("edit_form");
        var id = this.id;
        if(id == "upload")
        	form.action = "{{upload_url}}";
        else
        	form.action = "/editcourse/{{course.code}}";
    }
}

function submitfunc(){
	var form = document.getElementById("edit_form");
	var edit_module = document.getElementById("edit_module").value;
	if(edit_module == -1)
	{
		var module_name = document.getElementsByName("module_name")[0].value;
		if(module_name == "")
			form.action = "/editcourse/{{course.code}}";
	}
	var title = document.getElementsByName("subtitle")[0].value;
	if (title == "")
		form.action = "/editcourse/{{course.code}}";

	var clicked = getClickedValue("upload");
	if(clicked != "")
		var uploaded = document.getElementsByName(clicked)[0].value;
		if(uploaded == "")
			form.action = "/editcourse/{{course.code}}";
}

function moduleClick(module_id){
		var module_divs = document.getElementsByClassName("module");
		var i;
		for(i = 0;i<module_divs.length;i++)
			module_divs[i].style.display = "none";
		document.getElementById("module_"+module_id.toString()).style.display = "block";
		var contents = {{course.contents|tojson|safe}}
		document.getElementById("heading").innerHTML = "Adding New Lesson to Module "+(module_id+1).toString()+": "+contents[module_id]["name"];
		document.getElementById("edit_module").value = module_id.toString();
		document.getElementById("module_row").innerHTML = "";
}

function addModuleClick(){
	document.getElementById("add_module").href = "#";
	var module_divs = document.getElementsByClassName("module");
	var i;
	for(i = 0;i<module_divs.length;i++)
		module_divs[i].style.display = "none";
	document.getElementById("heading").innerHTML = "Adding New Module";
	document.getElementById("edit_module").value = "-1";
	document.getElementById("module_row").innerHTML = '<tr>	<td> <input type="text" name="module_name" placeholder="Name of module"> <div class="error">{{empty_title}}</div></td></tr>';
}

function lessonClick(module_id, lesson_id){}

</script>
{% endblock %}